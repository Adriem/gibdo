<!DOCTYPE html>  <html> <head>   <title>gibdo.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               gibdo.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><img src="game.png" alt="Screenshot" title="" /></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Gibdo is a starting point for creating HTML5 Canvas games in a 
top-down 2D style. It is written in <a href="http://coffeescript.org/">CoffeeScript</a> 
and provides the following features,</p>

<ul>
<li>A scrolling view window that tracks the player across the game world.</li>
<li>View edge detection to allow the player to move off the centre
of the screen as edges are reached.</li>
<li>Collision detection.</li>
<li>Keyboard input.</li>
<li>Sprite animation.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><a href="http://zeptojs.com/">Zepto.js</a> is used for event handling</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nx">Zepto</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Create a new instance of the game and get it running.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span> <span class="o">-&gt;</span> 
  <span class="nv">game = </span><span class="k">new</span> <span class="nx">Game</span>
  <span class="nx">game</span><span class="p">.</span><span class="nx">run</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Game</h2>

<p>The game class handles top level game loop and initialisation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Game</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Start the game in a default state and initiate the game loop. 
It attempts to run the loop every 1 millisecond but in reality 
the loop is just running as fast as it can.  </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">run: </span><span class="o">-&gt;</span>
    <span class="nx">@setup</span><span class="p">()</span>
    <span class="nx">@reset</span><span class="p">()</span>
    <span class="vi">@then = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="nx">@main</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Create a new game world and keyboard input handler</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setup: </span><span class="o">-&gt;</span>
    <span class="vi">@world = </span><span class="k">new</span> <span class="nx">World</span>
    <span class="vi">@inputHandler = </span><span class="k">new</span> <span class="nx">InputHandler</span><span class="p">(</span><span class="nx">@world</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Nothing is reset at this level so just ask the world to reset itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reset: </span><span class="o">-&gt;</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">reset</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The main game loop. Establish the time since the loop last ran
in seconds and pass that through to the update method for recalculating
sprite positions. After recalulation positions, render the sprites.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">main: </span><span class="o">=&gt;</span>
    <span class="nv">now = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="nv">delta = </span><span class="nx">now</span> <span class="o">-</span> <span class="nx">@lastUpdate</span>
    <span class="vi">@lastUpdate = </span><span class="nx">now</span>
    <span class="vi">@lastElapsed = </span><span class="nx">delta</span>
    <span class="nx">@update</span><span class="p">(</span><span class="nx">delta</span> <span class="err">/ 1000)</span>
    <span class="nx">@render</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Updates are handled by the input handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="nf">(modifier) -&gt;</span> <span class="nx">@inputHandler</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">modifier</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Tell the world to rerender itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="o">-&gt;</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">@lastUpdate</span><span class="p">,</span> <span class="nx">@lastElapsed</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>World</h2>

<p>The World class manages the game world and what can be seen
by the player.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">World</span>
  <span class="nv">width: </span><span class="mi">512</span>
  <span class="nv">height: </span><span class="mi">480</span>
  <span class="nv">viewWidth: </span><span class="mi">400</span>
  <span class="nv">viewHeight: </span><span class="mi">300</span>
  <span class="nv">sprites: </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>When the world is created it adds a canvas to the page and
inserts all the sprites that are needed into the sprite array.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="vi">@ctx = </span><span class="nx">@createCanvas</span><span class="p">()</span>
    <span class="vi">@hero = </span><span class="k">new</span> <span class="nx">Hero</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="vi">@collumn = </span><span class="k">new</span> <span class="nx">Collumn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Background</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Monster</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">@collumn</span><span class="p">)</span>
    <span class="nx">@sprites</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">@hero</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Create an HTML5 canvas element and append it to the document</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createCanvas: </span><span class="o">-&gt;</span>
    <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">)</span>
    <span class="nv">canvas.width = </span><span class="nx">@viewWidth</span>
    <span class="nv">canvas.height = </span><span class="nx">@viewHeight</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Only the hero (player character) needs to be reset.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reset: </span><span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="nx">@width</span><span class="p">,</span> <span class="nx">@height</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>The co-ordinates the hero occupies in the centre of the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">heroViewOffsetX: </span><span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">viewOffsetX</span><span class="p">(</span><span class="nx">@viewWidth</span><span class="p">)</span>
  <span class="nv">heroViewOffsetY: </span><span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">viewOffsetY</span><span class="p">(</span><span class="nx">@viewHeight</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>The maximum co-ordinates the view can scroll to.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">viewWidthLimit: </span> <span class="o">-&gt;</span> <span class="nx">@width</span>  <span class="o">-</span> <span class="nx">@viewWidth</span>
  <span class="nv">viewHeightLimit: </span><span class="o">-&gt;</span> <span class="nx">@height</span> <span class="o">-</span> <span class="nx">@viewHeight</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Check to see if the hero is at the limits of the world.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">atViewLimitLeft: </span>  <span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">@heroViewOffsetX</span><span class="p">()</span>
  <span class="nv">atViewLimitTop: </span>   <span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">@heroViewOffsetY</span><span class="p">()</span>
  <span class="nv">atViewLimitRight: </span> <span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">@viewWidthLimit</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@heroViewOffsetX</span><span class="p">()</span>
  <span class="nv">atViewLimitBottom: </span><span class="o">-&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">@viewHeightLimit</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@heroViewOffsetY</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Tell all the sprites to render.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(lastUpdate, lastElapsed) -&gt;</span> 
    <span class="nx">sprite</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span> <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@sprites</span>
    <span class="nx">@renderDebugOverlay</span><span class="p">(</span><span class="nx">lastElapsed</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Show the frames per second at the top of the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">renderDebugOverlay: </span><span class="nf">(lastElapsed) -&gt;</span>
    <span class="nx">@ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="vi">@ctx.fillStyle = </span><span class="s2">&quot;rgb(241, 241, 242)&quot;</span>
    <span class="vi">@ctx.font = </span><span class="s2">&quot;Bold 20px Monospace&quot;</span>
    <span class="nx">@ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;#{Math.round(1e3 / lastElapsed)} FPS&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nx">@ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Pass any keyboard events that come in from the input
handler off to the hero.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">up: </span>   <span class="nf">(mod) -&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">up</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
  <span class="nv">down: </span> <span class="nf">(mod) -&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">down</span><span class="p">(</span><span class="nx">mod</span><span class="p">,</span> <span class="nx">@height</span><span class="p">)</span>
  <span class="nv">left: </span> <span class="nf">(mod) -&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
  <span class="nv">right: </span><span class="nf">(mod) -&gt;</span> <span class="nx">@hero</span><span class="p">.</span><span class="nx">right</span><span class="p">(</span><span class="nx">mod</span><span class="p">,</span> <span class="nx">@width</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Find the sprites that have collision detection enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collidableSprites: </span><span class="o">-&gt;</span> <span class="nx">sprite</span> <span class="k">for</span> <span class="nx">sprite</span> <span class="k">in</span> <span class="nx">@sprites</span> <span class="k">when</span> <span class="nx">sprite</span><span class="p">.</span><span class="nx">collidable</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h2>InputHandler</h2>

<p>Responsible for dealing with keyboard input.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">InputHandler</span>
  <span class="nv">keysDown: </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Listen for keys being presses and being released. As this happens
add and remove them from the key store.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@world) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">keydown</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">@keysDown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">keyup</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="k">delete</span> <span class="nx">@keysDown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Everytime update is called from the game loop act on the currently
pressed keys by passing the events on to the world.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="nf">(modifier) -&gt;</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">up</span><span class="p">(</span><span class="nx">modifier</span><span class="p">)</span>    <span class="k">if</span> <span class="mi">38</span> <span class="k">of</span> <span class="nx">@keysDown</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">down</span><span class="p">(</span><span class="nx">modifier</span><span class="p">)</span>  <span class="k">if</span> <span class="mi">40</span> <span class="k">of</span> <span class="nx">@keysDown</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">modifier</span><span class="p">)</span>  <span class="k">if</span> <span class="mi">37</span> <span class="k">of</span> <span class="nx">@keysDown</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">right</span><span class="p">(</span><span class="nx">modifier</span><span class="p">)</span> <span class="k">if</span> <span class="mi">39</span> <span class="k">of</span> <span class="nx">@keysDown</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>SpriteImage</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SpriteImage</span>
  <span class="nv">ready: </span><span class="kc">false</span>
  <span class="nv">url: </span><span class="s2">&quot;images/sheet.png&quot;</span>

  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="nv">image = </span><span class="k">new</span> <span class="nx">Image</span>
    <span class="nv">image.src = </span><span class="nx">@url</span>
    <span class="nv">image.onload = </span><span class="o">=&gt;</span> <span class="vi">@ready = </span><span class="kc">true</span>
    <span class="vi">@image = </span><span class="nx">image</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h2>Sprite</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Sprite</span>
  <span class="nv">sx: </span><span class="mi">0</span>
  <span class="nv">sy: </span><span class="mi">0</span>
  <span class="nv">sw: </span><span class="mi">0</span>
  <span class="nv">sh: </span><span class="mi">0</span>
  <span class="nv">dx: </span><span class="mi">0</span>
  <span class="nv">dy: </span><span class="mi">0</span>
  <span class="nv">dw: </span><span class="mi">0</span>
  <span class="nv">dh: </span><span class="mi">0</span>
  <span class="nv">x: </span><span class="mi">0</span>
  <span class="nv">y: </span><span class="mi">0</span>
  <span class="nv">image: </span><span class="k">new</span> <span class="nx">SpriteImage</span>
  <span class="nv">collidable: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(@world) -&gt;</span>

  <span class="nv">drawImage: </span><span class="nf">(sx, sy, dx, dy) -&gt;</span>
    <span class="k">if</span> <span class="nx">@image</span><span class="p">.</span><span class="nx">ready</span>
      <span class="nx">@world</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">@image</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span> <span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">,</span> <span class="nx">@sw</span><span class="p">,</span> <span class="nx">@sh</span><span class="p">,</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">@dw</span><span class="p">,</span> <span class="nx">@dh</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h2>Background</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Background</span> <span class="k">extends</span> <span class="nx">Sprite</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>512x480</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(world) -&gt;</span>
    <span class="vi">@dw = </span><span class="nx">world</span><span class="p">.</span><span class="nx">viewWidth</span>
    <span class="vi">@dh = </span><span class="nx">world</span><span class="p">.</span><span class="nx">viewHeight</span>
    <span class="vi">@sw = </span><span class="nx">world</span><span class="p">.</span><span class="nx">viewWidth</span>
    <span class="vi">@sh = </span><span class="nx">world</span><span class="p">.</span><span class="nx">viewHeight</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">world</span><span class="p">)</span>

  <span class="nv">draw: </span><span class="o">-&gt;</span> 
    <span class="nv">x = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetX</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetY</span><span class="p">()</span>
    <span class="nv">x = </span><span class="mi">0</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitLeft</span><span class="p">()</span>
    <span class="nv">y = </span><span class="mi">0</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitTop</span><span class="p">()</span>
    <span class="nv">x = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">viewWidthLimit</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitRight</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">viewHeightLimit</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitBottom</span><span class="p">()</span>
    <span class="nx">@drawImage</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">@dx</span><span class="p">,</span> <span class="nx">@dy</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>Entity</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Entity</span> <span class="k">extends</span> <span class="nx">Sprite</span>
  <span class="nv">draw: </span><span class="o">-&gt;</span>
    <span class="vi">@dx = </span><span class="nx">@x</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitLeft</span><span class="p">()</span>
    <span class="vi">@dy = </span><span class="nx">@y</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitTop</span><span class="p">()</span>
    <span class="vi">@dx = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">viewWidthLimit</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitRight</span><span class="p">()</span>
    <span class="vi">@dy = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">viewHeightLimit</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">atViewLimitBottom</span><span class="p">()</span>
    <span class="nx">@drawImage</span><span class="p">(</span><span class="nx">@sx</span><span class="p">,</span> <span class="nx">@sy</span><span class="p">,</span> <span class="nx">@dx</span><span class="p">,</span> <span class="nx">@dy</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h2>Monster</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Monster</span> <span class="k">extends</span> <span class="nx">Entity</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>30 x 32</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">speed: </span><span class="mi">128</span>
  <span class="nv">x: </span><span class="mi">400</span>
  <span class="nv">y: </span><span class="mi">400</span>
  <span class="nv">sw: </span><span class="mi">30</span>
  <span class="nv">sh: </span><span class="mi">32</span>
  <span class="nv">dw: </span><span class="mi">30</span>
  <span class="nv">dh: </span><span class="mi">32</span>
  <span class="nv">sy: </span><span class="mi">480</span>
  <span class="nv">collidable: </span><span class="kc">true</span>

  <span class="nv">draw: </span><span class="o">-&gt;</span> 
    <span class="vi">@dx = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetX</span><span class="p">()</span>
    <span class="vi">@dy = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetY</span><span class="p">()</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h2>Collumn</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Collumn</span> <span class="k">extends</span> <span class="nx">Entity</span>
  <span class="nv">x: </span><span class="mi">300</span>
  <span class="nv">y: </span><span class="mi">300</span>
  <span class="nv">sw: </span><span class="mi">32</span>
  <span class="nv">sh: </span><span class="mi">32</span>
  <span class="nv">dw: </span><span class="mi">32</span>
  <span class="nv">dh: </span><span class="mi">32</span>
  <span class="nv">sy: </span><span class="mi">544</span>
  <span class="nv">collidable: </span><span class="kc">true</span>

  <span class="nv">draw: </span><span class="o">-&gt;</span> 
    <span class="vi">@dx = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetX</span><span class="p">()</span>
    <span class="vi">@dy = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetY</span><span class="p">()</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>Hero</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Hero</span> <span class="k">extends</span> <span class="nx">Entity</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>32 x 32</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sw: </span><span class="mi">32</span>
  <span class="nv">sh: </span><span class="mi">30</span>
  <span class="nv">dw: </span><span class="mi">32</span>
  <span class="nv">dh: </span><span class="mi">30</span>
  <span class="nv">speed: </span><span class="mi">256</span>
  <span class="nv">sy: </span><span class="mi">513</span>
  <span class="nv">direction: </span><span class="mi">0</span>

  <span class="nv">draw: </span><span class="o">-&gt;</span> 
    <span class="vi">@dx = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetX</span><span class="p">()</span>
    <span class="vi">@dy = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">heroViewOffsetY</span><span class="p">()</span>
    <span class="vi">@sx = </span><span class="k">if</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@x</span><span class="o">+</span><span class="nx">@y</span><span class="p">)</span><span class="o">%</span><span class="mi">64</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="k">then</span> <span class="nx">@direction</span> <span class="k">else</span> <span class="nx">@direction</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="k">super</span>

  <span class="nv">velocity: </span><span class="nf">(mod) -&gt;</span> <span class="nx">@speed</span> <span class="o">*</span> <span class="nx">mod</span>

  <span class="nv">collision: </span><span class="nf">(x, y) -&gt;</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">collidableSprites</span><span class="p">()</span>
      <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@dh</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">dh</span> <span class="o">and</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@dw</span> <span class="o">and</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">dw</span>
    <span class="kc">false</span>

  <span class="nv">up: </span><span class="nf">(mod) -&gt;</span> 
    <span class="vi">@direction = </span><span class="mi">64</span>
    <span class="nv">y = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
    <span class="nx">@y</span> <span class="o">-=</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">!</span><span class="nx">@collision</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  <span class="nv">down: </span><span class="nf">(mod, height) -&gt;</span> 
    <span class="vi">@direction = </span><span class="mi">0</span>
    <span class="nv">y = </span><span class="nx">@y</span> <span class="o">+</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">height</span> <span class="o">-</span> <span class="nx">@dh</span> <span class="o">and</span> <span class="o">!</span><span class="nx">@collision</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  <span class="nv">left: </span><span class="nf">(mod) -&gt;</span> 
    <span class="vi">@direction = </span><span class="mi">128</span>
    <span class="nv">x = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
    <span class="nx">@x</span> <span class="o">-=</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">!</span><span class="nx">@collision</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">)</span>
  <span class="nv">right: </span><span class="nf">(mod, width) -&gt;</span> 
    <span class="vi">@direction = </span><span class="mi">192</span>
    <span class="nv">x = </span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">@velocity</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">width</span> <span class="o">-</span> <span class="nx">@dw</span> <span class="o">and</span> <span class="o">!</span><span class="nx">@collision</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">)</span>

  <span class="nv">viewOffsetX: </span><span class="nf">(width)  -&gt;</span> <span class="p">(</span><span class="nx">width</span> <span class="sr">/ 2)   - (@dw /</span> <span class="mi">2</span><span class="p">)</span>
  <span class="nv">viewOffsetY: </span><span class="nf">(height) -&gt;</span> <span class="p">(</span><span class="nx">height</span> <span class="sr">/ 2)  - (@dh /</span> <span class="mi">2</span><span class="p">)</span>

  <span class="nv">reset: </span><span class="nf">(width, height) -&gt;</span>
    <span class="vi">@x = </span><span class="nx">@viewOffsetX</span><span class="p">(</span><span class="nx">width</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nx">@viewOffsetY</span><span class="p">(</span><span class="nx">height</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 